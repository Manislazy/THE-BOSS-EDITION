<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>THE BOSS EDITION 1 - Cultural Events</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    @import url('https://fonts.cdnfonts.com/css/old-style');

    :root { --primary:#0d3b66; --card:rgba(20,20,20,0.95); --danger:#e74c3c; --ok:#2ecc71; }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: 'Old Style', serif;
      background:url('background.jpg') no-repeat center center/cover;
      color:#fff;
    }
    header{
      background:rgba(13,59,102,0.95);
      color:#fff;
      padding:1rem;
      text-align:center;
      text-shadow:1px 1px 5px #000;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:1rem;
    }
    header img {
      height:60px;
      width:auto;
      border-radius:8px;
    }
    main{max-width:1100px;margin:auto;padding:1rem;backdrop-filter:blur(2px);}
    h2{margin-top:2rem;color:#4da6ff;text-shadow:1px 1px 3px #000}
    .grid{display:flex;flex-direction:column;gap:1rem;}
    .event-card{background:rgba(30,30,30,0.95);padding:1rem;border-radius:12px;box-shadow:0 8px 20px rgba(0,0,0,.8);}
    .card{background:rgba(20,20,20,0.95);padding:1rem;border-radius:12px;box-shadow:0 8px 20px rgba(0,0,0,.8);}
    button{background:var(--primary);color:#fff;border:none;padding:.6rem 1rem;border-radius:8px;cursor:pointer}
    input,select{width:100%;padding:.6rem;margin-bottom:.6rem;border-radius:8px;border:1px solid var(--primary);background:rgba(255,255,255,0.1);color:#fff}
    table{width:100%;border-collapse:collapse}
    th,td{padding:.5rem;border-bottom:1px solid rgba(255,255,255,0.2);color:#fff}
    #scanner{max-width:320px;margin:auto}
    .status{margin:.5rem 0;font-size:.9rem}
    .error{color:var(--danger)}
    .ok{color:var(--ok)}
    .small{font-size:.85rem;color:#ccc}
    .hidden{display:none;}
    .event-title{font-size:1.2rem;font-weight:bold;margin-bottom:.3rem;color:#ffd700;}
    .event-info{font-size:1rem;color:#cce0ff;}
  </style>
</head>
<body>
<header>
  <img src="kilifi logo.jpg" alt="Kilifi Logo" />
  <div>
    <h1>THE BOSS EDITION 1 - Cultural Events</h1>
    <p>Inspiring local events, traditions, and cultures, bringing love to the local community</p>
  </div>
</header>

<main>
  <div class="card">
    <strong>API Configuration</strong>
    <p class="small">Set this to your backend URL. Example: <code>http://localhost:3000</code> or a deployed URL.</p>
    <input id="apiInput" placeholder="API base URL" />
    <button onclick="applyApi()">Apply API</button>
    <div id="apiStatus" class="status"></div>
  </div>

  <div id="eventsSection">
    <h2>Upcoming Cultural Events</h2>
    <div class="grid" id="events"></div>

    <h2>Create Event (Admin)</h2>
    <div class="card">
      <form id="eventForm">
        <input id="title" placeholder="Event title" required />
        <input id="date" type="date" required />
        <input id="location" placeholder="Location" required />
        <input id="description" placeholder="Description" />
        <button type="submit">Add Event</button>
      </form>
      <div id="createStatus" class="status"></div>
    </div>

    <h2>Register for Event</h2>
    <div class="card">
      <select id="eventSelect"></select>
      <input id="regName" placeholder="Your name" />
      <input id="regPhone" placeholder="WhatsApp number" />
      <button onclick="registerAttendee()">Register</button>
      <div id="registerStatus" class="status"></div>
    </div>
  </div>

  <h2>Gate Check‑In (QR / Code)</h2>
  <div class="card">
    <input id="manualCode" placeholder="Enter code manually" />
    <button onclick="confirmManual()">Confirm</button>
    <div id="scanner"></div>
    <p id="scanResult" class="status"></p>
  </div>

  <h2>Attendance Statistics</h2>
  <div class="card" id="stats">Select an event to view stats.</div>
</main>

<script>
let API = localStorage.getItem('API_BASE') || '';
const apiInput = document.getElementById('apiInput');
const apiStatus = document.getElementById('apiStatus');
const eventsSection = document.getElementById('eventsSection');
apiInput.value = API;

function applyApi() {
  API = apiInput.value.replace(/\/$/, '');
  localStorage.setItem('API_BASE', API);
  if (API) {
    apiStatus.textContent = 'API set to ' + API;
    apiStatus.className = 'status ok';
    eventsSection.classList.remove('hidden');
    loadEvents();
  } else {
    apiStatus.textContent = 'API not set';
    apiStatus.className = 'status error';
    eventsSection.classList.add('hidden');
  }
}

async function safeFetch(url, options){
  if(!API) throw new Error('API not configured');
  const res = await fetch(url, options);
  if(!res.ok) throw new Error('HTTP ' + res.status);
  return res;
}

async function loadEvents(){
  try {
    const res = await safeFetch(API + '/events');
    const data = await res.json();
    const grid = document.getElementById('events');
    const select = document.getElementById('eventSelect');
    grid.innerHTML=''; select.innerHTML='';
    data.forEach(e => {
      grid.innerHTML += `
        <div class="event-card">
          <div class="event-title">${e.title}</div>
          <div class="event-info">${e.date} • ${e.location}</div>
          <div class="event-info">${e.description || ''}</div>
        </div>
      `;
      select.innerHTML += `<option value="${e.id}">${e.title}</option>`;
    });
  } catch(err) {
    apiStatus.textContent = 'Cannot reach API. Event sections hidden.';
    apiStatus.className = 'status error';
    eventsSection.classList.add('hidden');
  }
}
</script>
</body>
</html>
